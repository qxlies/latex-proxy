<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Latex Proxy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/darcula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <script src="https://unpkg.com/gpt-tokenizer"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
</head>
<body>
  <div id="auth-container">
    <div class="auth-box">
      <div id="login-form">
        <h2>Login</h2>
        <input type="text" id="login-username" placeholder="Username" required>
        <input type="password" id="login-password" placeholder="Password" required>
        <button id="login-btn">Login</button>
        <p>Don't have an account? <a href="#" id="show-register">Register</a></p>
      </div>
      <div id="register-form" class="hidden">
        <h2>Register</h2>
        <input type="text" id="register-username" placeholder="Username" required>
        <input type="password" id="register-password" placeholder="Password" required>
        <button id="register-btn">Register</button>
        <p>Already have an account? <a href="#" id="show-login">Login</a></p>
      </div>
    </div>
  </div>

  <main id="app" class="container hidden">
    <header class="hero">
      <div class="badge">CONDOM FOR PROMPTS</div>
      <h1>Latex Proxy</h1>
      <p class="sub">Formatting your prompts before they go in</p>
    </header>

    <section class="panel api">
      <div class="api-item">
        <div class="method">POST</div>
        <div class="path">/v1/chat/completions</div>
        <div class="spacer"></div>
        <div class="endpoint">
          <span class="full" id="endpointUrl"></span>
          <button id="copyEndpoint" class="icon-btn btn-blue" title="Copy" aria-label="Copy">
            <iconify-icon icon="lucide:copy"></iconify-icon>
          </button>
        </div>
      </div>
      <div class="api-item">
          <div class="method">AUTH</div>
          <div class="path">Your API Key</div>
          <div class="spacer"></div>
          <div class="endpoint">
            <span class="full" id="userApiKey"></span>
            <button id="copyUserApiKey" class="icon-btn btn-blue" title="Copy" aria-label="Copy">
              <iconify-icon icon="lucide:copy"></iconify-icon>
            </button>
          </div>
        </div>
    </section>

    <section class="panel profiles">
      <div class="profiles-compact">
        <div class="profiles-title">Current Profile</div>
        <div class="current-profile-display" id="currentProfileDisplay">
          <span class="current-profile-name">No profile selected</span>
          <span class="current-profile-badge api-active-indicator hidden" id="currentProfileBadge">API</span>
        </div>
        <button id="openProfilesModal" class="btn btn-blue">
          <iconify-icon icon="lucide:settings"></iconify-icon>
          Manage Profiles
        </button>
        <input type="file" id="importFileInput" accept=".json" style="display: none;">
      </div>
    </section>

    <!-- Profiles Modal -->
    <div id="profilesModal" class="modal hidden">
      <div class="modal-overlay" id="modalOverlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Profile Management</h2>
          <button class="modal-close" id="closeProfilesModal" title="Close">
            <iconify-icon icon="lucide:x"></iconify-icon>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-actions">
            <button id="newProfile" class="btn btn-green">
              <iconify-icon icon="lucide:plus"></iconify-icon>
              Create
            </button>
            <button id="importProfile" class="btn btn-green">
              <iconify-icon icon="lucide:upload"></iconify-icon>
              Import
            </button>
            <button id="exportProfile" class="btn btn-yellow">
              <iconify-icon icon="lucide:download"></iconify-icon>
              Export
            </button>
            <button id="setApiActiveProfile" class="btn btn-blue">
              <iconify-icon icon="lucide:check"></iconify-icon>
              Set for API
            </button>
          </div>
          <div class="profiles-list" id="profilesList"></div>
        </div>
      </div>
    </div>

    <section class="panel profile-settings">
      <h3 style="margin: 0 0 16px; font-size: 18px; font-weight: 600;">API Configuration</h3>
      
      <div class="provider-selector">
        <div class="provider-card openrouter" data-provider="openrouter">
          <iconify-icon icon="lucide:globe"></iconify-icon>
          <h4>OpenRouter</h4>
          <p>Access 200+ AI models via OpenRouter API</p>
        </div>

        <div class="provider-card aistudio" data-provider="aistudio">
          <iconify-icon icon="lucide:git-pull-request-arrow"></iconify-icon>
          <h4>Google AI Studio</h4>
          <p>Access to latest Gemini models</p>
        </div>
        
        <div class="provider-card free" data-provider="free">
          <iconify-icon icon="lucide:zap"></iconify-icon>
          <h4>Free Access</h4>
          <p>Free models without API key</p>
        </div>
        
        <div class="provider-card custom" data-provider="custom">
          <iconify-icon icon="lucide:settings-2"></iconify-icon>
          <h4>Custom Proxy</h4>
          <p>Use your own OpenAI-compatible endpoint</p>
        </div>
      </div>

      <!-- OpenRouter Settings -->
      <div id="openrouterSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:globe"></iconify-icon>
          <h3>OpenRouter Configuration</h3>
        </div>
        <div class="field">
          <span>API Key</span>
          <input id="openrouterApiKey" type="password" placeholder="sk-or-v1-...">
        </div>
        <div class="field">
          <span>Model</span>
          <div class="model-search-wrapper">
            <input
              id="openrouterModel"
              type="text"
              placeholder="Search models..."
              autocomplete="off"
              class="model-search"
            >
            <div id="openrouterModelDropdown" class="model-dropdown"></div>
          </div>
        </div>
      </div>

      <!-- AI Studio Settings -->
      <div id="aistudioSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:git-pull-request-arrow"></iconify-icon>
          <h3>AI Studio Configuration</h3>
        </div>
        <div class="field">
          <span>API Key</span>
          <input id="aistudioApiKey" type="password" placeholder="...">
        </div>
        <div class="field">
          <span>Model</span>
          <input id="aistudioModel" type="text" placeholder="gemini-2.5-pro">
        </div>
      </div>

      <!-- Free Provider Settings -->
      <div id="freeSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:zap"></iconify-icon>
          <h3>Free Access Configuration</h3>
        </div>
        <div class="free-notice">
          <p><strong>Free access provided by Latex Proxy</strong><br>No API key required. Choose your model below:</p>
        </div>
        <div class="field">
          <span>Model</span>
          <select id="freeModel">
            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
            <option value="gemini-flash-latest">Gemini Flash Latest</option>
          </select>
        </div>
      </div>

      <!-- Custom Proxy Settings -->
      <div id="customSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:settings-2"></iconify-icon>
          <h3>Custom Proxy Configuration</h3>
        </div>
        <div class="field">
          <span>Endpoint URL</span>
          <input id="customEndpoint" type="text" placeholder="https://api.example.com/v1/chat/completions">
          <small style="font-size: 11px; color: var(--muted); display: block; margin-top: 4px;">Full URL including /chat/completions</small>
        </div>
        <div class="field">
          <span>API Key</span>
          <input id="customApiKey" type="password" placeholder="Your API key">
        </div>
        <div class="field">
          <span>Model</span>
          <input id="customModel" type="text" placeholder="gpt-4, claude-3, etc.">
        </div>
      </div>

     <details class="spoiler" style="margin-top: 14px;">
       <summary>Extra Params</summary>
       <div class="field" style="margin-top: 8px;">
           <span>JSON</span>
           <textarea id="extraParams" rows="4" placeholder='{ "temperature": 0.7 }'></textarea>
       </div>
     </details>
    </section>

    <section class="panel documentation">
        <div class="doc-item btn-red">
            <iconify-icon icon="lucide:triangle-alert"></iconify-icon>
            <div>
                <h4>Setup</h4>
                <p>Paste this <code id="copySetupText" class="copyable-code">&lt;!user&gt;{{user}}&lt;/user&gt;&lt;character&gt;{{char}}&lt;/character&gt;</code> to your system prompt on JanitorAI (click to copy)</p>
            </div>
        </div>
        <div class="doc-item btn-blue">
            <iconify-icon icon="lucide:braces"></iconify-icon>
            <div>
                <h4>Placeholders</h4>
                <p>Use <code>{bot_persona}</code>, <code>{scenario}</code>, <code>{user_persona}</code>, <code>{summary}</code>, <code>{example_dialogs}</code>, <code>{lorebooks}</code>, <code>{{user}}</code> and <code>{{char}}</code> in your profile tabs. They will be replaced by content from the incoming API request's.</p>
            </div>
        </div>
        <div class="doc-item btn-green">
            <iconify-icon icon="lucide:cloud-download"></iconify-icon>
            <div>
                <h4>Sharing</h4>
                <p>Use <code>Import</code> and <code>Export</code> buttons to share templates with your friends.</p>
            </div>
        </div>
    </section>

    <section class="panel">
      <div class="editor-split">
        <aside class="tabs-pane">
          <div class="tabs-head">
            <div class="tabs-title">Tabs</div>
             <div class="tab-actions">
                <button id="moveTabUp" class="icon-btn" title="Move up" aria-label="Move up">
                   <iconify-icon icon="lucide:arrow-up"></iconify-icon>
               </button>
               <button id="moveTabDown" class="icon-btn" title="Move down" aria-label="Move down">
                   <iconify-icon icon="lucide:arrow-down"></iconify-icon>
               </button>
               <button id="toggleTab" class="icon-btn btn-ghost" title="Toggle" aria-label="Toggle">
                   <iconify-icon icon="lucide:eye"></iconify-icon>
               </button>
               <button id="deleteTab" class="icon-btn btn-red" title="Delete" aria-label="Delete">
                   <iconify-icon icon="lucide:trash-2"></iconify-icon>
               </button>
               <button id="addTab" class="icon-btn add-tab btn-green" title="Add tab" aria-label="Add tab">
                 <iconify-icon icon="lucide:plus"></iconify-icon>
               </button>
            </div>
          </div>
          <div class="tabs" id="tabs"></div>
        </aside>
        <div class="editor editor-pane">
          <div class="grid">
            <label class="field">
              <span>Role</span>
              <div class="custom-select-wrapper">
                <div class="custom-select" id="tabRoleCustom">
                  <div class="custom-select-trigger">
                    <span>system</span>
                    <iconify-icon icon="lucide:chevron-down"></iconify-icon>
                  </div>
                  <div class="custom-select-options">
                    <div class="custom-select-option" data-value="system">
                      <span class="role-badge system">S</span>
                      <span>system</span>
                    </div>
                    <div class="custom-select-option" data-value="user">
                      <span class="role-badge user">U</span>
                      <span>user</span>
                    </div>
                  </div>
                </div>
              </div>
            </label>
            <label class="field">
              <span>Name</span>
              <input id="tabTitle" type="text" placeholder="example: guidelines">
            </label>
          </div>
          <label class="field">
            <span>Content</span>
            <textarea id="tabContent" rows="8" placeholder="You are helpful assistant"></textarea>
          </label>
        </div>
      </div>
    </section>

    <section class="panel logs-panel">
       <div class="logs-header">
           <h3>Request Logs</h3>
           <label class="toggle-switch">
               <input type="checkbox" id="loggingToggle">
               <span class="slider"></span>
           </label>
       </div>
        <div id="logsContainer"></div>
        <div id="logsPagination"></div>
    </section>

    <footer class="foot">
        <div class="footer-left"></div>
        <div class="footer-center">
            <a href="https://github.com/qxlies/latex-proxy" target="_blank" rel="noopener noreferrer" class="footer-link">
                <iconify-icon icon="mdi:github"></iconify-icon>
                <span>Source code</span>
            </a>
        </div>
        <div class="footer-right">
            <button id="logout-btn" class="btn btn-red">Logout</button>
        </div>
    </footer>
  </main>
  <script type="module" src="./app.js"></script>
</body>
</html>