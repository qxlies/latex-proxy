<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Latex Proxy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/darcula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <script src="https://unpkg.com/gpt-tokenizer"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
</head>
<body>
  <div id="auth-container">
    <div class="auth-box">
      <div id="login-form">
        <h2>Login</h2>
        <input type="text" id="login-username" placeholder="Username" required>
        <input type="password" id="login-password" placeholder="Password" required>
        <button id="login-btn">Login</button>
        <p>Don't have an account? <a href="#" id="show-register">Register</a></p>
      </div>
      <div id="register-form" class="hidden">
        <h2>Register</h2>
        <input type="text" id="register-username" placeholder="Username" required>
        <input type="password" id="register-password" placeholder="Password" required>
        <button id="register-btn">Register</button>
        <p>Already have an account? <a href="#" id="show-login">Login</a></p>
      </div>
    </div>
  </div>

  <main id="app" class="container hidden">
    <header class="hero">
      <div class="badge">CONDOM FOR PROMPTS</div>
      <h1>Latex Proxy</h1>
      <p class="sub">Formatting your prompts before they go in</p>
    </header>

    <section class="panel api">
      <div class="api-item">
        <div class="method">POST</div>
        <div class="path">/v1/chat/completions</div>
        <div class="spacer"></div>
        <div class="endpoint">
          <span class="full" id="endpointUrl"></span>
          <button id="copyEndpoint" class="icon-btn btn-blue" title="Copy" aria-label="Copy">
            <iconify-icon icon="lucide:copy"></iconify-icon>
          </button>
        </div>
      </div>
      <div class="api-item">
          <div class="method">AUTH</div>
          <div class="path">Your API Key</div>
          <div class="spacer"></div>
          <div class="endpoint">
            <span class="full" id="userApiKey"></span>
            <button id="copyUserApiKey" class="icon-btn btn-blue" title="Copy" aria-label="Copy">
              <iconify-icon icon="lucide:copy"></iconify-icon>
            </button>
          </div>
        </div>
    </section>

    <section class="panel profiles">
      <div class="profiles-compact">
        <div class="profiles-title">Current Profile</div>
        <div class="current-profile-display" id="currentProfileDisplay">
          <span class="current-profile-name">No profile selected</span>
          <span class="current-profile-badge api-active-indicator hidden" id="currentProfileBadge">API</span>
        </div>
        <button id="openProfilesModal" class="btn btn-blue">
          <iconify-icon icon="lucide:settings"></iconify-icon>
          Manage Profiles
        </button>
        <input type="file" id="importFileInput" accept=".json" style="display: none;">
      </div>
    </section>

    <!-- Profiles Modal -->
    <div id="profilesModal" class="modal hidden">
      <div class="modal-overlay" id="modalOverlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Profile Management</h2>
          <button class="modal-close" id="closeProfilesModal" title="Close">
            <iconify-icon icon="lucide:x"></iconify-icon>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-actions">
            <button id="newProfile" class="btn btn-green">
              <iconify-icon icon="lucide:plus"></iconify-icon>
              Create
            </button>
            <button id="importProfile" class="btn btn-green">
              <iconify-icon icon="lucide:upload"></iconify-icon>
              Import
            </button>
            <button id="exportProfile" class="btn btn-yellow">
              <iconify-icon icon="lucide:download"></iconify-icon>
              Export
            </button>
            <button id="setApiActiveProfile" class="btn btn-blue">
              <iconify-icon icon="lucide:check"></iconify-icon>
              Set for API
            </button>
          </div>
          <div class="profiles-list" id="profilesList"></div>
        </div>
      </div>
    </div>

    <section class="panel profile-settings">
      <h3 style="margin: 0 0 16px; font-size: 18px; font-weight: 600;">API Configuration</h3>
      
      <div class="provider-selector">
        <div class="provider-card gorouter" data-provider="gorouter">
          <iconify-icon icon="lucide:route"></iconify-icon>
          <h4>GoRouter</h4>
          <span class="provider-badge free-plan">FREE PLAN</span>
          <p>By Latex ‚Ä¢ 500k tok/day ‚Ä¢ Claude, OpenAI & more</p>
        </div>

        <div class="provider-card openrouter" data-provider="openrouter">
          <iconify-icon icon="lucide:globe"></iconify-icon>
          <h4>OpenRouter</h4>
          <p>Access 200+ AI models via OpenRouter API</p>
        </div>

        <div class="provider-card aistudio" data-provider="aistudio">
          <iconify-icon icon="lucide:git-pull-request-arrow"></iconify-icon>
          <h4>Google AI Studio</h4>
          <p>Access to latest Gemini models</p>
        </div>
        
        <!-- <div class="provider-card free" data-provider="free">
          <iconify-icon icon="lucide:zap"></iconify-icon>
          <h4>Free Access</h4>
          <p>Free models without API key</p>
        </div>
         -->
        <div class="provider-card custom" data-provider="custom">
          <iconify-icon icon="lucide:settings-2"></iconify-icon>
          <h4>Custom Proxy</h4>
          <p>Use your own OpenAI-compatible endpoint</p>
        </div>
      </div>

      <!-- GoRouter Settings -->
      <div id="gorouterSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:route"></iconify-icon>
          <h3>GoRouter Configuration</h3>
        </div>
        <div class="gorouter-notice">
          <p><strong>üéâ Free Plan Available!</strong><br>
          API –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ Latex —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º Free Plan: 500k —Ç–æ–∫–µ–Ω–æ–≤ –≤ –¥–µ–Ω—å –∏ –¥–æ—Å—Ç—É–ø–æ–º –∫ –º–æ–¥–µ–ª—è–º Claude, OpenAI –∏ –¥—Ä—É–≥–∏–º —á–µ—Ä–µ–∑ OpenRouter.</p>
          <a href="https://discord.gg/Az7pRmY9SR" target="_blank" class="discord-invite-btn">
            <iconify-icon icon="lucide:message-circle"></iconify-icon>
            Join Discord Server
          </a>
        </div>
        <div class="field">
          <span>API Key</span>
          <input id="gorouterApiKey" type="password" placeholder="Enter your GoRouter API key">
        </div>
        <div class="field">
          <span>Model</span>
          <div class="model-search-wrapper">
            <input
              id="gorouterModel"
              type="text"
              placeholder="Select or type model..."
              autocomplete="off"
              class="model-search"
            >
            <div id="gorouterModelDropdown" class="model-dropdown"></div>
          </div>
        </div>
        
        <div class="gorouter-advanced">
          <h4>Advanced Options</h4>
          
          <div class="field">
            <label class="custom-checkbox">
              <input type="checkbox" id="gorouterThinkingEnabled">
              <span class="checkbox-custom"></span>
              <span class="checkbox-label-text">Enable Thinking Mode</span>
            </label>
          </div>
          
          <div class="field" id="gorouterEffortField">
            <span>Thinking Effort</span>
            <select id="gorouterEffort">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          
          <div class="field" id="gorouterProviderField">
            <span>Provider Selection</span>
            <select id="gorouterProvider">
              <option value="">Auto (Default)</option>
              <option value="Google" selected>Google (No Moderation)</option>
              <option value="Anthropic">Anthropic</option>
            </select>
            <small class="provider-hint">Google provider has no content moderation</small>
          </div>
        </div>
      </div>

      <!-- OpenRouter Settings -->
      <div id="openrouterSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:globe"></iconify-icon>
          <h3>OpenRouter Configuration</h3>
        </div>
        <div class="field">
          <span>API Key</span>
          <input id="openrouterApiKey" type="password" placeholder="sk-or-v1-...">
        </div>
        <div class="field">
          <span>Model</span>
          <div class="model-search-wrapper">
            <input
              id="openrouterModel"
              type="text"
              placeholder="Search models..."
              autocomplete="off"
              class="model-search"
            >
            <div id="openrouterModelDropdown" class="model-dropdown"></div>
          </div>
        </div>
      </div>

      <!-- AI Studio Settings -->
      <div id="aistudioSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:git-pull-request-arrow"></iconify-icon>
          <h3>AI Studio Configuration</h3>
        </div>
        <div class="field">
          <span>API Key</span>
          <input id="aistudioApiKey" type="password" placeholder="...">
        </div>
        <div class="field">
          <span>Model</span>
          <input id="aistudioModel" type="text" placeholder="gemini-2.5-pro">
        </div>
      </div>

      <!-- Free Provider Settings
      <div id="freeSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:zap"></iconify-icon>
          <h3>Free Access Configuration</h3>
        </div>
        <div class="free-notice">
          <p><strong>Free access provided by Latex Proxy</strong><br>No API key required. Choose your model below:</p>
        </div>
        <div class="field">
          <span>Model</span>
          <select id="freeModel">
            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
            <option value="gemini-flash-latest">Gemini Flash Latest</option>
          </select>
        </div>
      </div> -->

      <!-- Custom Proxy Settings -->
      <div id="customSettings" class="provider-settings">
        <div class="provider-header">
          <iconify-icon icon="lucide:settings-2"></iconify-icon>
          <h3>Custom Proxy Configuration</h3>
        </div>
        <div class="field">
          <span>Endpoint URL</span>
          <input id="customEndpoint" type="text" placeholder="https://api.example.com/v1/chat/completions">
          <small style="font-size: 11px; color: var(--muted); display: block; margin-top: 4px;">Full URL including /chat/completions</small>
        </div>
        <div class="field">
          <span>API Key</span>
          <input id="customApiKey" type="password" placeholder="Your API key">
        </div>
        <div class="field">
          <span>Model</span>
          <input id="customModel" type="text" placeholder="gpt-4, claude-3, etc.">
        </div>
      </div>

     <details class="spoiler" style="margin-top: 14px;">
       <summary>Extra Params</summary>
       <div class="field" style="margin-top: 8px;">
           <span>JSON</span>
           <textarea id="extraParams" rows="4" placeholder='{ "temperature": 0.7 }'></textarea>
       </div>
     </details>
    </section>

    <section class="panel documentation">
        <div class="doc-item btn-red">
            <iconify-icon icon="lucide:triangle-alert"></iconify-icon>
            <div>
                <h4>Setup</h4>
                <p>Paste this <code id="copySetupText" class="copyable-code">&lt;!user&gt;{{user}}&lt;/user&gt;&lt;character&gt;{{char}}&lt;/character&gt;</code> to your system prompt on JanitorAI (click to copy)</p>
            </div>
        </div>
        <div class="doc-item btn-blue">
            <iconify-icon icon="lucide:braces"></iconify-icon>
            <div>
                <h4>Placeholders</h4>
                <p>Use <code>{bot_persona}</code>, <code>{scenario}</code>, <code>{user_persona}</code>, <code>{summary}</code>, <code>{example_dialogs}</code>, <code>{lorebooks}</code>, <code>{{user}}</code> and <code>{{char}}</code> in your profile tabs. They will be replaced by content from the incoming API request's.</p>
            </div>
        </div>
        <div class="doc-item btn-green">
            <iconify-icon icon="lucide:cloud-download"></iconify-icon>
            <div>
                <h4>Sharing</h4>
                <p>Use <code>Import</code> and <code>Export</code> buttons to share templates with your friends.</p>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="panel faq-section">
      <div class="section-header">
        <iconify-icon icon="lucide:help-circle"></iconify-icon>
        <h3>FAQ - Frequently Asked Questions</h3>
      </div>
      
      <details class="faq-item" open>
        <summary>
          <iconify-icon icon="lucide:chevron-right" class="chevron"></iconify-icon>
          <span>How to set up JanitorAI to work with Latex Proxy?</span>
        </summary>
        <div class="faq-content">
          <ol class="faq-steps">
            <li>
              <strong>Copy your API Key</strong> from the block above (click the copy button next to "Your API Key"):<br>
              <code class="inline-code copyable-faq-code" id="faqApiKey" data-copy-text="">Click to copy your API key</code>
            </li>
            <li>
              <strong>Go to JanitorAI</strong> and open API Settings in the chat
            </li>
            <li>
              <strong>Select "Proxy"</strong> as the provider and create a new profile
            </li>
            <li>
              <strong>Paste the Endpoint URL:</strong><br>
              <code class="inline-code copyable-faq-code" data-copy-text="https://latex.ai.bobots.me/v1/chat/completions">https://latex.ai.bobots.me/v1/chat/completions</code>
            </li>
            <li>
              <strong>Paste your API Key</strong> from Latex Proxy
            </li>
            <li>
              <strong>In Custom Prompt paste:</strong><br>
              <code class="inline-code copyable-faq-code" data-copy-text="<!user>{{user}}</user><character>{{char}}</character>">&lt;!user&gt;{{user}}&lt;/user&gt;&lt;character&gt;{{char}}&lt;/character&gt;</code>
            </li>
            <li>
              <strong>Import a profile:</strong>
              <ul>
                <li>Return to Latex Proxy</li>
                <li>Click "Manage Profiles"</li>
                <li>Select the desired profile or create a new one</li>
                <li>Click "Export" to download the profile</li>
                <li>Click "Import" to upload a ready-made profile</li>
                <li>Click "Set for API" to activate the profile for API use</li>
              </ul>
            </li>
            <li>
              <strong>Done!</strong> You can now start chatting with the bot on JanitorAI
            </li>
          </ol>
        </div>
      </details>

      <details class="faq-item">
        <summary>
          <iconify-icon icon="lucide:chevron-right" class="chevron"></iconify-icon>
          <span>What are profiles and why are they needed?</span>
        </summary>
        <div class="faq-content">
          <p>Profiles allow you to create different sets of system prompts for different tasks or characters. Each profile contains a set of tabs with instructions that will be sent to the model.</p>
          <p>You can create an unlimited number of profiles, switch between them, and share them with friends through Import/Export functions.</p>
        </div>
      </details>

      <details class="faq-item">
        <summary>
          <iconify-icon icon="lucide:chevron-right" class="chevron"></iconify-icon>
          <span>How do placeholders work?</span>
        </summary>
        <div class="faq-content">
          <p>Placeholders are special markers in your tabs that are automatically replaced with real data from the request:</p>
          <ul>
            <li><code class="inline-code">{bot_persona}</code> - bot character description</li>
            <li><code class="inline-code">{scenario}</code> - dialogue scenario</li>
            <li><code class="inline-code">{user_persona}</code> - user description</li>
            <li><code class="inline-code">{summary}</code> - summary</li>
            <li><code class="inline-code">{example_dialogs}</code> - example dialogues</li>
            <li><code class="inline-code">{lorebooks}</code> - lorebooks</li>
            <li><code class="inline-code">{{user}}</code> - user name</li>
            <li><code class="inline-code">{{char}}</code> - character name</li>
          </ul>
        </div>
      </details>

      <details class="faq-item">
        <summary>
          <iconify-icon icon="lucide:chevron-right" class="chevron"></iconify-icon>
          <span>What is GoRouter and how is it different from other providers?</span>
        </summary>
        <div class="faq-content">
          <p><strong>GoRouter</strong> is an API provider from the Latex developer with advantages:</p>
          <ul>
            <li>üéâ <strong>Free plan:</strong> 500,000 tokens per day</li>
            <li>üöÄ <strong>Access to top models:</strong> Claude, OpenAI, Gemini and others via OpenRouter</li>
            <li>üß† <strong>Support for all features:</strong> enabling reasoning, changing provider, etc.</li>
            <li>üí∞ <strong>Affordable paid plans:</strong> for those who need more</li>
          </ul>
          <p>Join the Discord server to get an API key!</p>
        </div>
      </details>
    </section>

    <!-- Changelog Section -->
    <section class="panel changelog-section">
      <div class="section-header">
        <iconify-icon icon="lucide:git-commit"></iconify-icon>
        <h3>Changelog</h3>
      </div>
      
      <div class="changelog-content">
        <div class="changelog-entry">
          <div class="changelog-version">
            <span class="version-badge">v1.0.0</span>
            <span class="version-date">2025-01-26</span>
          </div>
          <div class="changelog-changes">
            <h4>üéâ Initial Release</h4>
            <ul>
              <li>Modular prompt system with tabs</li>
              <li>Support for multiple providers (GoRouter, OpenRouter, AI Studio, Custom)</li>
              <li>Profile system with Import/Export</li>
              <li>Request logging and analysis of all blocks</li>
              <li>Placeholders for dynamic data substitution</li>
            </ul>
          </div>
        </div>

        <!-- Placeholder for future updates -->
        <div class="changelog-placeholder">
          <p>Future updates will be displayed here...</p>
        </div>
      </div>
    </section>

    <section class="panel">
      <div class="merge-roles-section">
        <label class="custom-checkbox merge-roles-toggle">
          <input type="checkbox" id="mergeConsecutiveRoles" checked>
          <span class="checkbox-custom"></span>
          <span class="checkbox-label-text">
            Merge Consecutive Roles
            <span class="info-icon" title="When enabled, consecutive messages with the same role (e.g., multiple 'system' messages) will be merged into one. Disable this for advanced experimentation with role sequences to influence model understanding.">
              <iconify-icon icon="lucide:info"></iconify-icon>
            </span>
          </span>
        </label>
      </div>
      
      <div class="editor-split">
        <aside class="tabs-pane">
          <div class="tabs-head">
            <div class="tabs-title">Tabs</div>
             <div class="tab-actions">
                <button id="moveTabUp" class="icon-btn" title="Move up" aria-label="Move up">
                   <iconify-icon icon="lucide:arrow-up"></iconify-icon>
               </button>
               <button id="moveTabDown" class="icon-btn" title="Move down" aria-label="Move down">
                   <iconify-icon icon="lucide:arrow-down"></iconify-icon>
               </button>
               <button id="toggleTab" class="icon-btn btn-ghost" title="Toggle" aria-label="Toggle">
                   <iconify-icon icon="lucide:eye"></iconify-icon>
               </button>
               <button id="deleteTab" class="icon-btn btn-red" title="Delete" aria-label="Delete">
                   <iconify-icon icon="lucide:trash-2"></iconify-icon>
               </button>
               <button id="addTab" class="icon-btn add-tab btn-green" title="Add tab" aria-label="Add tab">
                 <iconify-icon icon="lucide:plus"></iconify-icon>
               </button>
            </div>
          </div>
          <div class="tabs" id="tabs"></div>
        </aside>
        <div class="editor editor-pane">
          <div class="grid">
            <label class="field">
              <span>Role</span>
              <div class="custom-select-wrapper">
                <div class="custom-select" id="tabRoleCustom">
                  <div class="custom-select-trigger">
                    <span>system</span>
                    <iconify-icon icon="lucide:chevron-down"></iconify-icon>
                  </div>
                  <div class="custom-select-options">
                    <div class="custom-select-option" data-value="system">
                      <span class="role-badge system">S</span>
                      <span>system</span>
                    </div>
                    <div class="custom-select-option" data-value="user">
                      <span class="role-badge user">U</span>
                      <span>user</span>
                    </div>
                  </div>
                </div>
              </div>
            </label>
            <label class="field">
              <span>Name</span>
              <input id="tabTitle" type="text" placeholder="example: guidelines">
            </label>
          </div>
          <label class="field">
            <span>Content</span>
            <textarea id="tabContent" rows="8" placeholder="You are helpful assistant"></textarea>
          </label>
        </div>
      </div>
    </section>

    <section class="panel logs-panel">
       <div class="logs-header">
           <h3>Request Logs</h3>
           <label class="toggle-switch">
               <input type="checkbox" id="loggingToggle">
               <span class="slider"></span>
           </label>
       </div>
        <div id="logsContainer"></div>
        <div id="logsPagination"></div>
    </section>

    <footer class="foot">
        <div class="footer-left"></div>
        <div class="footer-center">
            <a href="https://github.com/qxlies/latex-proxy" target="_blank" rel="noopener noreferrer" class="footer-link">
                <iconify-icon icon="mdi:github"></iconify-icon>
                <span>Source code</span>
            </a>
        </div>
        <div class="footer-right">
            <button id="logout-btn" class="btn btn-red">Logout</button>
        </div>
    </footer>
  </main>
  
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>
  
  <script type="module" src="./js/app.js"></script>
</body>
</html>